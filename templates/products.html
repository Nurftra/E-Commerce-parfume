{% extends 'base.html' %}
{% from '_pagination.html' import render_pagination %}

{% block title %}Semua Produk - Parfume Shop{% endblock %}

{% block content %}
<h2 class="mb-4">Semua Produk</h2>

<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
  {% for p in products_pagination.items %}
  <!-- Product Card -->
  <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col">
    <a href="{{ url_for('product_detail', product_id=p.id) }}">
      <img src="{{ p.image_url or 'https://source.unsplash.com/400x300/?perfume' }}" alt="{{ p.name }}" class="w-full h-48 object-cover hover:opacity-75 transition-opacity duration-300">
    </a>
    <div class="p-4 flex flex-col flex-grow">
      <h3 class="text-lg font-semibold text-gray-800">{{ p.name }}</h3>
      <p class="text-gray-500 text-sm mt-1 flex-grow">{{ p.description[:80] }}{% if p.description|length > 80 %}...{% endif %}</p>
      <p class="text-xl font-bold text-pink-600 mt-2">{{ p.price|rupiah }}</p>
      
      <!-- Tombol Aksi -->
      <div class="mt-4">
          {% if current_user %}
            <form action="{{ url_for('add_to_cart', product_id=p.id) }}" method="POST">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <input type="hidden" name="quantity" value="1">
              <button type="submit" class="w-full bg-pink-500 text-white py-2 rounded-md hover:bg-pink-600 transition duration-300">
                Tambah ke Keranjang
              </button>
            </form>
          {% else %}
            <a href="{{ url_for('login', next=request.path) }}" class="block w-full text-center bg-gray-200 text-gray-800 py-2 rounded-md hover:bg-gray-300 transition duration-300">
              Login untuk Beli
            </a>
          {% endif %}
          <a href="{{ url_for('product_detail', product_id=p.id) }}" class="block w-full text-center mt-2 bg-white border border-gray-300 text-gray-700 py-2 rounded-md hover:bg-gray-50 transition duration-300">
            Lihat Detail
          </a>
      </div>
    </div>
  </div>
  {% else %}
    <div class="col-span-full"><p class="text-center text-gray-500">Produk tidak ditemukan.</p></div>
  {% endfor %}
</div>

<div class="mt-5">
  {{ render_pagination(products_pagination, 'products_list', search=search) }}
</div>
{% endblock %}